{% extends "/templates/admin.php.twig" %}

{% block title %}Editar usuario{% endblock %}

{% block name %}Editar usuario{% endblock %}
{% block content %}
    <div class="flex flex-col h-full">
        <form id="editUserForm" action="/admin/users/edit/{{ user.id }}" method="POST">
            <div class="mb-4">
                <label for="name" class="block text-gray-700 text-sm font-bold mb-2">Nombre:</label>
                <input type="text" id="name" name="name" value="{{ user.name }}" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            </div>
            <div class="mb-4">
                <label for="email" class="block text-gray-700 text-sm font-bold mb-2">Correo:</label>
                <input type="email" id="email" name="email" value="{{ user.email }}" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            </div>
            <div class="mb-4">
                <label for="password" class="block text-gray-700 text-sm font-bold mb-2">Nueva contraseña (dejar en blanco para no cambiar):</label>
                <input type="password" id="password" name="password" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            </div>
            <div class="mb-4">
                <label for="password_confirm" class="block text-gray-700 text-sm font-bold mb-2">Confirmar contraseña:</label>
                <input type="password" id="password_confirm" name="password_confirm" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            </div>
            <div class="mb-4">
                <label for="role" class="block text-gray-700 text-sm font-bold mb-2">Rol:</label>
                <select id="role" name="role" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    <option value="0" {% if user.role and user.role.value == 0 %}selected{% endif %}>Cliente</option>
                    <option value="1" {% if user.role and user.role.value == 1 %}selected{% endif %}>Empleado</option>
                    <option value="2" {% if user.role and user.role.value == 2 %}selected{% endif %}>Administrador</option>
                </select>
            </div>
            <div class="mb-4">
                <label for="points" class="block text-gray-700 text-sm font-bold mb-2">Puntos:</label>
                <input type="number" id="points" name="points" value="{{ user.points }}" min="0" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            </div>
            <input type="submit" class="btn primary" value="Guardar cambios">
        </form>
    </div>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('editUserForm').addEventListener('submit', function(event) {
        const pass = document.getElementById('password').value;
        const pass2 = document.getElementById('password_confirm').value;
        if (!document.getElementById('name').value || !document.getElementById('email').value) {
            alert('Por favor completa todos los campos obligatorios.');
            event.preventDefault();
            return;
        }
        if (pass || pass2) {
            if (pass !== pass2) {
                alert('Las contraseñas no coinciden.');
                event.preventDefault();
                return;
            }
        }
    });
</script>
{% endblock %}
